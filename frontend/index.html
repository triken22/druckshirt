<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DruckMeinShirt - Design & Order</title>
    <link rel="stylesheet" href="./src/style.css" />
    <!-- Load Stripe.js early -->
    <script src="https://js.stripe.com/v3/" defer></script>
    <!-- PostHog Snippet -->
    <script>
      !(function (t, e) {
        var o, n, p, r;
        e.__SV ||
          ((window.posthog = e),
          (e._i = []),
          (e.init = function (i, s, a) {
            function g(t, e) {
              var o = e.split(".");
              2 == o.length && ((t = t[o[0]]), (e = o[1])),
                (t[e] = function () {
                  t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
                });
            }
            ((p = t.createElement("script")).type = "text/javascript"),
              (p.crossOrigin = "anonymous"),
              (p.async = !0),
              (p.src =
                s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") +
                "/static/array.js"),
              (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(
                p,
                r
              );
            var u = e;
            for (
              void 0 !== a ? (u = e[a] = []) : (a = "posthog"),
                u.people = u.people || [],
                u.toString = function (t) {
                  var e = "posthog";
                  return (
                    "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e
                  );
                },
                u.people.toString = function () {
                  return u.toString(1) + ".people (stub)";
                },
                o =
                  "init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug getPageViewId captureTraceFeedback captureTraceMetric".split(
                    " "
                  ),
                n = 0;
              n < o.length;
              n++
            )
              g(u, o[n]);
            e._i.push([i, s, a]);
          }),
          (e.__SV = 1));
      })(document, window.posthog || []);
      posthog.init("phc_8ipgZfvHLUHGZ6J8b9AlkviiEzib4c77qhN69T9x4pK", {
        api_host: "https://us.i.posthog.com",
        person_profiles: "identified_only", // or 'always'
        // Opt-out check will be handled in main.js after init
      });
    </script>
    <!-- End PostHog Snippet -->
  </head>
  <body>
    <header>
      <h1>DruckMeinShirt</h1>
      <nav>
        <button class="nav-button" data-target="design-section">Design</button>
        <button class="nav-button" data-target="token-purchase-section">
          Tokens
        </button>
        <button class="nav-button" data-target="recovery-section">
          Grant ID Wiederherstellen
        </button>
        <!-- TODO: Links Impressum/Datenschutz -->
      </nav>
      <div id="token-balance-display">Tokens: Lade...</div>
    </header>

    <main>
      <section id="image-source-section">
        <h2>1. Bildquelle Auswählen</h2>
        <div class="tabs">
          <button class="tab-button active" data-target="image-upload-content">
            Bild Hochladen
          </button>
          <button class="tab-button" data-target="ai-generation-content">
            AI Bild Generieren
          </button>
        </div>

        <div id="image-upload-content" class="tab-content active">
          <h3>Bild Hochladen</h3>
          <input
            type="file"
            id="image-upload-input"
            accept=".png, .jpg, .jpeg"
          />
          <button id="image-upload-button">Für Design Verwenden</button>
          <div id="upload-status"></div>
          <div id="image-preview-upload"></div>
        </div>

        <div id="ai-generation-content" class="tab-content">
          <h3>AI Bild Generieren (kostet 1 Token)</h3>
          <label for="ai-prompt-input">Prompt eingeben:</label>
          <textarea
            id="ai-prompt-input"
            rows="3"
            placeholder="z.B. ein süßes Kätzchen im Cyberpunk-Stil"
          ></textarea>
          <button id="ai-generate-button">Generieren</button>
          <div id="ai-status"></div>
          <div id="ai-results-grid">
            <!-- Generated images will appear here -->
          </div>
          <div id="image-preview-ai"></div>
        </div>
      </section>

      <hr />

      <section id="design-section">
        <h2>2. T-Shirt Gestalten</h2>
        <div class="design-layout">
          <div class="design-controls">
            <h3>Produkt Wählen</h3>
            <div id="product-list">
              <!-- Product options load here -->
              <p>Lade Produkte...</p>
            </div>
            <h3>Farbe Wählen</h3>
            <div id="color-swatches">
              <!-- Color options load here -->
              <p>Wähle zuerst ein Produkt.</p>
            </div>
            <h3>Größe Wählen</h3>
            <div id="size-selector">
              <p>Wähle zuerst Farbe.</p>
            </div>
            <h3>Menge</h3>
            <label for="quantity-input">Anzahl:</label>
            <input
              type="number"
              id="quantity-input"
              value="1"
              min="1"
              max="10"
            />
          </div>
          <div class="mockup-area-container">
            <h3>Vorschau & Bearbeitung</h3>
            <div id="mockup-area">
              <div
                id="mockup-background"
                style="
                  width: 300px;
                  height: 350px;
                  background-color: #ccc;
                  position: relative;
                  border: 1px solid #999;
                  margin: 0 auto;
                  background-image: url('placeholder-tshirt.png');
                  background-size: contain;
                  background-repeat: no-repeat;
                  background-position: center;
                "
              >
                <!-- Placeholder for T-shirt image -->
                <div
                  id="design-image-container"
                  style="
                    position: absolute;
                    top: 25%;
                    left: 30%;
                    width: 40%;
                    cursor: grab;
                  "
                >
                  <img
                    id="design-image-overlay"
                    src=""
                    alt="Design Vorschau"
                    style="
                      width: 100%;
                      height: auto;
                      object-fit: contain;
                      display: none;
                      pointer-events: none;
                    "
                  />
                  <!-- Basic Resize Handle -->
                  <div class="resize-handle"></div>
                </div>
              </div>
            </div>
            <div class="mockup-controls">
              <label for="image-scale-slider">Größe:</label>
              <input
                type="range"
                id="image-scale-slider"
                min="0.1"
                max="1.5"
                step="0.05"
                value="1"
              />
            </div>
          </div>
        </div>
        <div id="design-status"></div>
        <button
          id="proceed-to-checkout-button"
          style="margin-top: 1rem; display: none"
          disabled
        >
          Weiter zum Checkout
        </button>
      </section>

      <hr />

      <section id="checkout-section" style="display: none">
        <h2>3. Bestellung Abschließen</h2>
        <div id="order-summary"></div>
        <form id="shipping-form">
          <h3>Lieferadresse</h3>
          <label for="shipping-name">Name:</label>
          <input type="text" id="shipping-name" required />
          <label for="shipping-address1">Adresse Zeile 1:</label>
          <input type="text" id="shipping-address1" required />
          <label for="shipping-address2">Adresse Zeile 2 (Optional):</label>
          <input type="text" id="shipping-address2" />
          <label for="shipping-city">Stadt:</label>
          <input type="text" id="shipping-city" required />
          <label for="shipping-zip">PLZ:</label>
          <input type="text" id="shipping-zip" required />
          <label for="shipping-country">Land:</label>
          <select id="shipping-country" required>
            <option value="DE">Deutschland</option>
            <option value="AT">Österreich</option>
            <option value="CH">Schweiz</option>
            <!-- TODO: Add other EU countries if needed -->
          </select>
          <label for="shipping-email">Email (für Bestellupdates):</label>
          <input type="email" id="shipping-email" required />
          <button type="button" id="get-shipping-button">
            Versandoptionen Anzeigen
          </button>
        </form>
        <div id="shipping-options-container" style="margin-top: 1rem">
          <h3>Versandart Wählen</h3>
          <div id="shipping-options-list"></div>
          <div id="shipping-status"></div>
        </div>
        <div
          id="tshirt-payment-container"
          style="margin-top: 1rem; display: none"
        >
          <h3>Zahlung</h3>
          <div id="tshirt-payment-element-container"></div>
          <button id="submit-tshirt-order-button" style="margin-top: 1rem">
            Bestellung Bezahlen
          </button>
          <div id="tshirt-payment-message"></div>
        </div>
        <div id="order-confirmation-message" style="margin-top: 1rem"></div>
      </section>

      <hr />

      <section id="token-purchase-section">
        <h2>Tokens Kaufen (Optional)</h2>
        <p>Kaufe Tokens, um mehr AI-Bilder zu generieren.</p>
        <label for="email-input">Email:</label>
        <input
          type="email"
          id="email-input"
          placeholder="deine@email.com"
          required
        />
        <button id="buy-tokens-button">10 Tokens für €5 Kaufen</button>
        <div
          id="payment-element-container"
          style="margin-top: 1rem; display: none"
        ></div>
        <button
          id="submit-payment-button"
          style="display: none; margin-top: 1rem"
        >
          Bezahlen
        </button>
        <div id="payment-message"></div>
        <div
          id="grant-id-display"
          style="margin-top: 1rem; font-weight: bold"
        ></div>
      </section>

      <hr />

      <section id="recovery-section" style="display: none">
        <h2>Grant ID Wiederherstellung</h2>
        <p>
          Gib deine Email-Adresse ein, um deine gekauften Grant IDs
          wiederherzustellen.
        </p>
        <label for="recovery-email-input">Email:</label>
        <input type="email" id="recovery-email-input" required />
        <button id="recovery-request-button">
          Wiederherstellung Anfordern
        </button>
        <div id="recovery-message"></div>
      </section>
    </main>

    <footer>
      <div class="footer-content">
        <p>&copy; 2024 DruckMeinShirt</p>
        <div class="legal-links">
          <!-- TODO: Add actual links -->
          <a href="#">Impressum</a> | <a href="#">Datenschutz</a>
        </div>
        <div class="analytics-opt-out">
          <input type="checkbox" id="posthog-opt-out-toggle" />
          <label for="posthog-opt-out-toggle"
            >Anonymes Analytics-Tracking deaktivieren</label
          >
        </div>
      </div>
    </footer>

    <script type="module" src="./src/main.js"></script>
  </body>
</html>
